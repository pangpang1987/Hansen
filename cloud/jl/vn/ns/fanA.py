#-*- coding:utf-8 -*-
#指定中文编码

######################################################################################
#
#   通风动力模块----fanA
#
######################################################################################

#   网络中的风机动力是 -
#   计算回路阻力代数和时，直接代数相加，动力不要按习惯 -

from    .vp     import  VentPower

#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
#
#	风路类
#
class FanA(VentPower) :
    #€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€
    #   构造函数
    def __init__(self, id, a0, a1, a2) :
        VentPower.__init__(self, id)
        self.a0     =   a0
        self.a1     =   a1
        self.a2     =   a2
    #€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€

    #€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€
    #   动力计算函数
    def GetH(self, q):
        return self.a0 + self.a1*q + self.a2*q**2
    #€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€

    #€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€
    #   动力计算函数斜率, 修正误差+abs
    def GetSlope(self, q):
        return self.a1 + 2*self.a2*q
    #€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€

#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

#€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€
#
#   计算驼峰
#
def GetHump(a0, a1, a2) :

    # print(a0,a1,a2)

    humpQ = - a1 / (2 * a2)
    humpH = (4 * a2 * a0 - a1**2) / (4 * a2)
    # print("-----------------",humpQ,humpH)
    return humpQ, humpH
#€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€

#€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€
#
#   横轴交点
#
def HorizontalAxisIntersectionA(a0, a1, a2, h=0) :
    q1 = (-a1 + pow((a1**2 - 4*a2*a0 + 4*a2*h),0.5))/(2*a2)
    q2 = (-a1 - pow((a1**2 - 4*a2*a0 + 4*a2*h),0.5))/(2*a2)
    # 返回结果：小, 大
    if q1 < q2 :
        return q1, q2       # 返回大风量
    else :
        return q2, q1
#€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€

#€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€
#
#   风机初始风量
#
def GetInitQ(a0, a1, a2, k=0.75) :
    # k=0.75 初始风量在驼峰的0.75高度
    # 1. 计算驼峰
    humpQ, humpH = GetHump(a0, a1, a2)

    # 2. 0.75*hunpH高度处右侧值
    q1, q2 = HorizontalAxisIntersectionA(a0, a1, a2, h=humpH*k)
    return int(q2)          # 小数位数太多不利于初始化
#€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€€